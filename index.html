<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Packing List</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f3f3f3;
    margin: 0;
    padding: 20px;
  }

  .page {
    background: #ffffff;
    max-width: 900px;
    margin: 0 auto 20px auto;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
  }

  h1 {
    text-align: center;
    margin-top: 10px;
    letter-spacing: 1px;
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 15px;
  }

  .header textarea {
    width: 260px;
    height: 90px;
    resize: vertical;
    font-size: 14px;
  }

  .logo {
    width: 160px;
    height: auto;
    object-fit: contain;
  }

  .section {
    margin-top: 18px;
    font-weight: bold;
    text-transform: uppercase;
    font-size: 14px;
  }

  input, textarea {
    width: 100%;
    padding: 6px;
    font-size: 14px;
    margin-top: 4px;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-sizing: border-box;
  }

  textarea {
    resize: vertical;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    font-size: 14px;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: left;
  }

  th {
    background: #e7e7e7;
    text-transform: uppercase;
    font-size: 12px;
  }

  .btn {
    padding: 8px 12px;
    border: none;
    background: #0078d7;
    color: white;
    font-size: 14px;
    border-radius: 5px;
    cursor: pointer;
    margin-right: 6px;
    margin-top: 8px;
  }

  .btn-secondary {
    background: #666666;
  }

  .btn-danger {
    background: #c62828;
  }

  .signature {
    margin-top: 40px;
    text-align: center;
    width: 100%;
  }

  .signature-line {
    width: 300px;
    margin: 0 auto 6px auto;
    border-bottom: 2px solid #000;
    height: 40px;
  }

  @media print {
    body {
      background: #ffffff;
      padding: 0;
      margin: 0;
    }
    #archive,
    .no-print {
      display: none !important;
    }
    .page {
      box-shadow: none;
      border-radius: 0;
      margin: 0;
    }
  }
</style>
</head>
<body>

<div class="page">

  <div class="header">
    <textarea id="company">Your Company Name
Street & No
ZIP / City
Country
Phone:
Email:</textarea>

    <img src="logo.png" class="logo">
  </div>

  <h1>Packing List</h1>

  <div class="section">Shipper</div>
  <textarea id="shipper"></textarea>

  <div class="section">Consignee</div>
  <textarea id="consignee"></textarea>

  <div class="section">Details</div>
  <input type="text" id="packingNo" placeholder="Packing List No.">
  <input type="date" id="packingDate">
  <input type="text" id="reference" placeholder="Reference No.">
  <input type="text" id="contact" placeholder="Contact Person">

  <div class="section">Items</div>
  <button class="btn btn-secondary no-print" onclick="addRow()">+ Add Item</button>

  <table id="items">
    <thead>
      <tr>
        <th>No.</th>
        <th>Description</th>
        <th>Qty</th>
        <th>Unit</th>
        <th>Net Weight</th>
        <th>Gross Weight</th>
        <th class="no-print">Delete</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="section">Notes</div>
  <textarea id="notes" style="height:80px;"></textarea>

  <br>

  <button class="btn no-print" onclick="save()">Save to archive</button>
  <button class="btn-secondary btn no-print" onclick="newList()">New packing list</button>
  <button class="btn no-print" onclick="window.print()">Print / Save PDF</button>

  <div class="signature">
    <div class="signature-line"></div>
    <div>Signature</div>
  </div>

</div>

<div id="archive" class="page no-print">
  <h2>Archive</h2>
  <table id="archiveTable">
    <thead>
      <tr>
        <th>No.</th>
        <th>Date</th>
        <th>Consignee</th>
        <th>Load</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
let STORAGE_KEY = "packing_archive_v2";
let archive = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

function addRow(data = {}) {
  let tbody = document.querySelector("#items tbody");
  let tr = document.createElement("tr");

  tr.innerHTML = `
    <td>${tbody.children.length + 1}</td>
    <td><input value="${data.desc || ""}"></td>
    <td><input type="number" value="${data.qty || ""}"></td>
    <td><input value="${data.unit || ""}"></td>
    <td><input value="${data.net || ""}"></td>
    <td><input value="${data.gross || ""}"></td>
    <td class="no-print"><button class="btn-danger" onclick="this.parentNode.parentNode.remove(); renumber();">X</button></td>
  `;

  tbody.appendChild(tr);
}

function renumber() {
  [...document.querySelectorAll("#items tbody tr")].forEach((tr, i) => {
    tr.children[0].textContent = i + 1;
  });
}

function collect() {
  let rows = [...document.querySelectorAll("#items tbody tr")].map(tr => ({
    desc: tr.children[1].querySelector("input").value,
    qty: tr.children[2].querySelector("input").value,
    unit: tr.children[3].querySelector("input").value,
    net: tr.children[4].querySelector("input").value,
    gross: tr.children[5].querySelector("input").value
  }));

  return {
    id: Date.now(),
    company: document.getElementById("company").value,
    shipper: document.getElementById("shipper").value,
    consignee: document.getElementById("consignee").value,
    packingNo: document.getElementById("packingNo").value,
    packingDate: document.getElementById("packingDate").value,
    reference: document.getElementById("reference").value,
    contact: document.getElementById("contact").value,
    notes: document.getElementById("notes").value,
    rows
  };
}

function save() {
  let data = collect();
  archive.push(data);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(archive));
  renderArchive();
  alert("Saved!");
}

function renderArchive() {
  let tbody = document.querySelector("#archiveTable tbody");
  tbody.innerHTML = "";

  archive.forEach(entry => {
    let tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${entry.packingNo}</td>
      <td>${entry.packingDate}</td>
      <td>${entry.consignee.split("\n")[0] || ""}</td>
      <td><button onclick='loadEntry(${entry.id})'>Load</button></td>
      <td><button class="btn-danger" onclick='deleteEntry(${entry.id})'>X</button></td>
    `;
    tbody.appendChild(tr);
  });
}

function loadEntry(id) {
  let data = archive.find(x => x.id === id);
  if (!data) return;

  document.getElementById("company").value = data.company;
  document.getElementById("shipper").value = data.shipper;
  document.getElementById("consignee").value = data.consignee;
  document.getElementById("packingNo").value = data.packingNo;
  document.getElementById("packingDate").value = data.packingDate;
  document.getElementById("reference").value = data.reference;
  document.getElementById("contact").value = data.contact;
  document.getElementById("notes").value = data.notes;

  document.querySelector("#items tbody").innerHTML = "";
  data.rows.forEach(r => addRow(r));
}

function deleteEntry(id) {
  archive = archive.filter(x => x.id !== id);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(archive));
  renderArchive();
}

function newList() {
  location.reload();
}

renderArchive();
addRow();
</script>

</body>
</html>
