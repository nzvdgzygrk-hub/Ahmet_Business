<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Packing List</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background: #f5f5f7;
      margin: 0;
      padding: 20px;
    }

    .page {
      max-width: 900px;
      margin: 0 auto 30px auto;
      background: #ffffff;
      padding: 30px 35px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    h1 {
      text-align: center;
      margin: 0 0 20px 0;
      letter-spacing: 1px;
      font-size: 24px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 20px;
    }

    .company {
      font-size: 14px;
      line-height: 1.3;
    }

    .logo {
      max-width: 170px;
      max-height: 80px;
      object-fit: contain;
    }

    .section-title {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .flex-row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .box {
      border: 1px solid #d0d4dc;
      border-radius: 8px;
      padding: 10px 12px;
      margin-bottom: 15px;
      flex: 1;
      min-width: 220px;
      background: #fafbff;
    }

    label {
      font-size: 12px;
      color: #555;
      display: block;
      margin-bottom: 3px;
    }

    input[type="text"],
    input[type="date"],
    textarea {
      width: 100%;
      border-radius: 5px;
      border: 1px solid #c8ccd4;
      padding: 6px 8px;
      font-size: 13px;
      outline: none;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    textarea:focus {
      border-color: #0078d7;
      box-shadow: 0 0 0 2px rgba(0,120,215,0.15);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 5px;
      font-size: 13px;
    }

    th, td {
      border: 1px solid #d0d4dc;
      padding: 6px 8px;
      text-align: left;
      vertical-align: top;
    }

    th {
      background: #f1f3f7;
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
    }

    td input[type="text"],
    td input[type="number"] {
      width: 100%;
      border-radius: 4px;
      border: 1px solid #c8ccd4;
      padding: 4px 6px;
      font-size: 12px;
    }

    td input[type="number"] {
      text-align: right;
    }

    .btn {
      border: none;
      border-radius: 6px;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      margin-right: 6px;
      margin-bottom: 6px;
    }

    .btn-primary {
      background: #0078d7;
      color: #fff;
    }

    .btn-secondary {
      background: #e1e5ee;
      color: #333;
    }

    .btn-danger {
      background: #e55353;
      color: #fff;
    }

    .btn:active {
      transform: translateY(1px);
    }

    .btn-icon {
      padding: 4px 8px;
      font-size: 11px;
    }

    .button-row {
      margin-top: 15px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .signature-area {
      margin-top: 30px;
      display: flex;
      justify-content: flex-end;
    }

    .signature-box {
      width: 260px;
      text-align: center;
      font-size: 12px;
    }

    .signature-line {
      border-bottom: 1px solid #000;
      margin: 40px 0 4px 0;
    }

    .archive {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px 25px;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .archive h2 {
      margin-top: 0;
      font-size: 18px;
    }

    .archive-table th,
    .archive-table td {
      font-size: 12px;
    }

    .archive-empty {
      font-size: 13px;
      color: #666;
      font-style: italic;
      margin-top: 5px;
    }

    .meta-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px 16px;
      margin-bottom: 10px;
    }

    .meta-field input {
      width: 100%;
    }

    @media print {
      body {
        background: #ffffff;
        padding: 0;
      }
      .page {
        box-shadow: none;
        border-radius: 0;
        margin: 0;
      }
      .archive,
      .no-print {
        display: none !important;
      }
    }
  </style>
</head>
<body>

  <!-- PACKING LIST DOKUMENT -->
  <div class="page">
    <div class="header">
      <div class="company">
        <strong>Ihre Firma</strong><br>
        Straße Nr.<br>
        PLZ Ort<br>
        Deutschland<br>
        Tel.: +49 ...<br>
        E-Mail: info@firma.de
      </div>
      <div>
        <!-- Logo: lege logo.jpg in den gleichen Ordner wie diese index.html -->
        <img src="logo.jpg" alt="Logo" class="logo">
      </div>
    </div>

    <h1>PACKING LIST</h1>

    <!-- Adressen -->
    <div class="flex-row">
      <div class="box">
        <div class="section-title">Absender</div>
        <label for="shipper">Firma / Name</label>
        <textarea id="shipper"></textarea>
      </div>
      <div class="box">
        <div class="section-title">Empfänger</div>
        <label for="consignee">Firma / Name</label>
        <textarea id="consignee"></textarea>
      </div>
    </div>

    <!-- Metadaten -->
    <div class="box">
      <div class="section-title">Details</div>
      <div class="meta-row">
        <div class="meta-field">
          <label for="packingNo">Packing List Nr.</label>
          <input type="text" id="packingNo" />
        </div>
        <div class="meta-field">
          <label for="packingDate">Datum</label>
          <input type="date" id="packingDate" />
        </div>
        <div class="meta-field">
          <label for="referenceNo">Referenz / Bestellung</label>
          <input type="text" id="referenceNo" />
        </div>
        <div class="meta-field">
          <label for="customerNo">Kundennummer</label>
          <input type="text" id="customerNo" />
        </div>
        <div class="meta-field">
          <label for="contactPerson">Ansprechpartner</label>
          <input type="text" id="contactPerson" />
        </div>
      </div>
    </div>

    <!-- Positionen -->
    <div class="box">
      <div class="section-title">Positionen</div>
      <button class="btn btn-secondary btn-icon no-print" id="addRowBtn">+ Position hinzufügen</button>
      <table id="itemsTable">
        <thead>
        <tr>
          <th style="width:50px;">Pos.</th>
          <th>Beschreibung</th>
          <th style="width:80px;">Menge</th>
          <th style="width:80px;">Einheit</th>
          <th style="width:60px;" class="no-print">Aktion</th>
        </tr>
        </thead>
        <tbody id="itemsBody">
        <!-- Dynamische Zeilen -->
        </tbody>
      </table>
    </div>

    <!-- Hinweise -->
    <div class="box">
      <div class="section-title">Hinweise</div>
      <textarea id="notes" placeholder="z.B. Lieferbedingungen, besondere Hinweise zur Verpackung, etc."></textarea>
    </div>

    <!-- Buttons -->
    <div class="button-row no-print">
      <button class="btn btn-primary" id="saveBtn">Speichern in Archiv</button>
      <button class="btn btn-secondary" id="newBtn">Neue Packliste</button>
      <button class="btn btn-secondary" id="printBtn">Drucken</button>
      <button class="btn btn-danger" id="deleteCurrentBtn">Aktuelle Packliste aus Archiv löschen</button>
    </div>

    <!-- Unterschrift -->
    <div class="signature-area">
      <div class="signature-box">
        <div class="signature-line"></div>
        <div>Ort, Datum und Unterschrift</div>
      </div>
    </div>
  </div>

  <!-- ARCHIV -->
  <div class="archive no-print">
    <h2>Archiv – gespeicherte Packing Lists</h2>
    <table class="archive-table" id="archiveTable">
      <thead>
      <tr>
        <th style="width:130px;">Packing List Nr.</th>
        <th style="width:110px;">Datum</th>
        <th>Empfänger</th>
        <th style="width:100px;">Referenz</th>
        <th style="width:140px;">Aktionen</th>
      </tr>
      </thead>
      <tbody id="archiveBody">
      </tbody>
    </table>
    <div id="archiveEmpty" class="archive-empty">Noch keine Packlisten gespeichert.</div>
  </div>

  <script>
    // --- Datenmodell & LocalStorage-Key ---
    const STORAGE_KEY = "packingListArchive_v1";
    let archive = [];
    let currentId = null; // ID der gerade bearbeiteten Packliste

    // --- DOM-Elemente ---
    const itemsBody = document.getElementById("itemsBody");
    const addRowBtn = document.getElementById("addRowBtn");
    const saveBtn = document.getElementById("saveBtn");
    const newBtn = document.getElementById("newBtn");
    const printBtn = document.getElementById("printBtn");
    const deleteCurrentBtn = document.getElementById("deleteCurrentBtn");
    const archiveBody = document.getElementById("archiveBody");
    const archiveEmpty = document.getElementById("archiveEmpty");

    function getField(id) {
      return document.getElementById(id);
    }

    // --- Positionen-Handling ---
    function addRow(positionData = {}) {
      const row = document.createElement("tr");

      const posCell = document.createElement("td");
      posCell.textContent = itemsBody.children.length + 1;

      const descCell = document.createElement("td");
      const descInput = document.createElement("input");
      descInput.type = "text";
      descInput.value = positionData.description || "";
      descCell.appendChild(descInput);

      const qtyCell = document.createElement("td");
      const qtyInput = document.createElement("input");
      qtyInput.type = "number";
      qtyInput.step = "any";
      qtyInput.min = "0";
      qtyInput.value = positionData.quantity || "";
      qtyCell.appendChild(qtyInput);

      const unitCell = document.createElement("td");
      const unitInput = document.createElement("input");
      unitInput.type = "text";
      unitInput.value = positionData.unit || "";
      unitCell.appendChild(unitInput);

      const actionCell = document.createElement("td");
      actionCell.classList.add("no-print");
      const delBtn = document.createElement("button");
      delBtn.textContent = "X";
      delBtn.className = "btn btn-danger btn-icon";
      delBtn.onclick = () => {
        row.remove();
        renumberRows();
      };
      actionCell.appendChild(delBtn);

      row.appendChild(posCell);
      row.appendChild(descCell);
      row.appendChild(qtyCell);
      row.appendChild(unitCell);
      row.appendChild(actionCell);

      itemsBody.appendChild(row);
    }

    function renumberRows() {
      Array.from(itemsBody.children).forEach((row, index) => {
        row.firstChild.textContent = index + 1;
     
